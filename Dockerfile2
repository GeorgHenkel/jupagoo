FROM airhacks/java
LABEL maintainer="Georg Henkel, georg-henkel.de" description="Glassfish v5 with HSQL-DB"

ENV GLASSFISH_ARCHIVE glassfish5
ENV DOMAIN_NAME domain1
ENV INSTALL_DIR /

RUN curl -o ${INSTALL_DIR}/${GLASSFISH_ARCHIVE}.zip -L http://download.oracle.com/glassfish/5.0/release/glassfish-5.0.zip \ 
    && unzip ${INSTALL_DIR}/${GLASSFISH_ARCHIVE}.zip -d ${INSTALL_DIR} \ 
    && rm ${INSTALL_DIR}/${GLASSFISH_ARCHIVE}.zip
    
ENV GLASSFISH_HOME ${INSTALL_DIR}/${GLASSFISH_ARCHIVE}/glassfish
ENV DEPLOYMENT_DIR ${GLASSFISH_HOME}/domains/${DOMAIN_NAME}/autodeploy
ENV LIB_DIR ${GLASSFISH_HOME}/domains/${DOMAIN_NAME}/lib/ext

WORKDIR ${GLASSFISH_HOME}/bin
ENTRYPOINT asadmin start-domain --verbose ${DOMAIN_NAME}
RUN asadmin create-jdbc-connection-pool --restype=javax.sql.DataSource --datasourceclassname=org.hsqldb.jdbc.JDBCDataSource --property "user=sa:password=sa:url=jdbc:hsqldb:mem:jupagoo" jUpaGooPool
RUN asadmin create-jdbc-resource --connectionpoolid jUpaGooPool jdbc/jupagoo
EXPOSE 4848 8009 8080 8181